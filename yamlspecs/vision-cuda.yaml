!include pymodule.yaml
---
- package: vision cuda enabled
  name: vision
  suffix: -cuda
  pkgname: "pytorch-python{{python_version}}-{{name}}{{suffix}}"
  version: "{{versions.vision}}"
  vendor_source: https://github.com/pytorch/vision/archive/v{{version}}.{{extension}}
  description: |
    The torchvision package consists of popular datasets, model architectures,
     and common image transformations for computer vision
  build:
    configure: echo No configure required
    modules: 
      - "pytorch/{{versions.pytorch}}"
    pkgmake: >
      export CUDA_HOME=$$CUDA_PATH;
      export FORCE_CUDA=1;
      export LIBRARY_PATH=$$LD_LIBRARY_PATH;
      export CMAKE_INCLUDE_PATH=/opt/apps/ffmpeg/4.1.3/include:$$MKL_INCLUDE_DIR:$$CMAKE_INCLUDE_PATH;
      export CMAKE_LIBRARY_PATH=$$LD_LIBRARY_PATH:$$CMAKE_LIBRARY_PATH;
      python{{python_major}} ./setup.py build
  files:
    - "{{root}}/lib/python{{python_family}}/site-packages/*"

  requires:
    - python_{{python_version}}
    - pytorch{{suffix}}_{{versions.pytorch}}
